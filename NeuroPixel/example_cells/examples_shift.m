shift_path = '/Volumes/Samsung_T5/speed_filtered_new_22binspace_5binspeed2/';
data_path = '/Volumes/Samsung_T5/attialex/NP_Data';
save_path = '/Volumes/Samsung_T5/examples_shift2/';
if ~isfolder(save_path)
    mkdir(save_path);
end
ops = load(fullfile(shift_path,'parameters.mat'));
ops = ops.ops;
ops.speedWindow = [-10 -1]; % in cm
ops.midpoints = ops.edges(1:end-1)*.5+ops.edges(2:end)*.5;
%%
% 
% cells = {
% {'AA1_190726_gain_1.mat',380,102:130},...
% {'AA1_190726_gain_1.mat',485,102:130},...
% {'AA1_190728_gaincontrast10_1.mat',277,6:34},...
% {'AA1_190729_gain_1.mat',543,102:130},...
% {'AA4_190805_gaincontrast10_2.mat',321,6:34},...
% {'AA44_190926_gain_1.mat',416,6:34},... %RSC
% {'AA44_190926_gain_1.mat',509,102:130},...
% {'AA44_190926_gain_1.mat',518,6:34},...
% {'AA44_190927_gaincontrast10_1.mat',131,6:34},...
% {'AA44_190927_gaincontrast10_1.mat',139,6:34},...
% {'AA44_190927_gaincontrast10_1.mat',146,6:34},...
% {'AA46_190919_gain_1.mat',470,102:130},...
% {'AA46_190919_gain_1.mat',473,102:130},...
% {'AA47_190927_gaincontrast10_1.mat',272,102:130},...
% {'AA47_190927_gaincontrast10_1.mat',284,6:34},...
% {'AA47_190927_gaincontrast10_1.mat',301,6:34},...
% {'AA50_191003_gain_1.mat',456,102:130},...
% {'npF4_1023_gaincontrast_1.mat',44,6:34},... %MEC
% {'npF4_1023_gaincontrast_1.mat',804,6:34},...
% {'npG1_1219_gain_1.mat',770,150:178},...
% {'npG5_1207_gain_1.mat',103,126:154},...
% {'npG5_1207_gain_1.mat',846,126:154},...
% {'npH3_0401_gain_1.mat',336,6:34},...
% {'npH3_0402_gaincontrast_1.mat',45,6:34},...
% {'npI3_0424_gaincontrast20_2.mat',223,102:130},...
% };
%%
cells = {
{'AA1_190726_gain_1.mat',380,102:120},...
{'AA1_190726_gain_1.mat',485,102:120},...
{'AA1_190729_gain_1.mat',543,102:120},...
{'AA3_190801_gain_3.mat',218,6:24},...
{'AA4_190805_gaincontrast10_2.mat',321,6:24},...
{'AA46_190921_gaincontrast10_combined.mat',521,6:24},...
{'AA44_190926_gain_1.mat',416,6:24},... %RSC
{'AA44_190927_gaincontrast10_1.mat',139,6:24},...
{'AA46_190919_gain_1.mat',470,102:120},...
{'AA47_190927_gaincontrast10_1.mat',301,6:24},...
{'npF4_1023_gaincontrast_1.mat',44,6:24},... %MEC
{'npF4_1023_gaincontrast_1.mat',804,6:24},...
{'npH3_0402_gaincontrast_1.mat',45,6:24},...
{'npJ3_0509_gaincontrast20_smallgainonly_1.mat',630,6:24},...
{'npI4_0424_gaincontrast10_smallgainonly_1.mat',541,9:27},...
};
%%
cells = {
{'npF4_1023_gaincontrast_1.mat',804,6:24},...%MEC
{'AA1_190726_gain_1.mat',380,102:120},... %V1
{'AA44_190927_gaincontrast10_1.mat',139,6:24},...%RSC
{'npI4_0424_gaincontrast10_smallgainonly_1.mat',541,9:27},... %MEC
{'AA46_190921_gaincontrast10_combined.mat',521,6:24},...$V1
{'AA47_190927_gaincontrast10_1.mat',301,6:24},...%RSC
{'AA4_190805_gaincontrast10_2.mat',321,6:24},...%V1 example shift
};
%%
masterfig = figure('Position',[240         791        1518         307]);

for iC=1:numel(cells)
    shift_data = load(fullfile(shift_path,cells{iC}{1}));
    data = load(fullfile(data_path,cells{iC}{1}));
    
    cluID = cells{iC}{2};
    ops.trials = cells{iC}{3};
    ops.bl_pre = 1:15;
        ops.gain_trials = 16:19;
        ops.bl_post = [];
     if iC<=6
     figure(masterfig)
     subplot_ax_spikes = subplot(2,6,iC*2-1);
     subplot_ax_speed = subplot(2,6,iC*2);
     else
         subplot_ax_spikes = [];
         subplot_ax_speed=[];
     end
     fig=plotExampleCellShift(data,shift_data,cluID,ops,subplot_ax_spikes,subplot_ax_speed);
     
    set(gcf,'Position',[440   236   652   562])
    for ii=1:4
        subplot(4,2,ii)
        ylim([0 20])
    end
    for ii=4:8
        subplot(4,2,ii)
        ylim([ops.trials(1),ops.trials(1)+18])
    end
    for ii=4:8
        ax = subplot(4,2,ii);
        clim=get(ax,'Clim');
        clim(2)=clim(2)*.8;
        set(ax,'Clim',clim);
    end
    [~,sn]=fileparts(cells{iC}{1});
    shift_idx = find(shift_data.CID==cells{iC}{2});
    reg = shift_data.region{shift_idx};
    save_name = sprintf('%s_%s_c%d.pdf',sn,reg,cluID);
    saveas(fig.fig,fullfile(save_path,save_name));
    close(fig.fig)
end
saveas(masterfig,fullfile(save_path,'examples_shift_all.pdf'))